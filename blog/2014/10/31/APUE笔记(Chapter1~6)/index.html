
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>APUE笔记(Chapter 1~6) - 乌衣巷</title>
	<meta name="author" content="吴逸翔">

	
	<meta name="description" content="APUE笔记(Chapter 1~6) APUE笔记(Chapter 1~6) 1.UNIX System Overview Nonfatal error(man 3 errno) EAGAIN/EWOULDBLOCK
ENFILE/ENOBUFS/ENOLCK/ENOSPC/ENOSR/ &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="" rel="alternate" title="乌衣巷" type="application/atom+xml">
	
	<link rel="canonical" href="http://CodePeasant.github.io/blog/2014/10/31/APUE%E7%AC%94%E8%AE%B0%28Chapter1%7E6%29/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-45832206-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("1032197148@qq.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>
<hgroup>
  <h1><a href="/">乌衣巷</a></h1>
  
    <h2>临渊羡鱼，不如退而结网</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">轨迹</a></li>
  <li><a href="/technology">技术</a></li>
  <li><a href="/management">技术之外</a></li>
  <li><a href="/aboutme">我</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="weibo" href="http://www.weibo.com/1959085582" title="Weibo">Weibo</a>
		
		
		
		
		
			<a class="github" href="https://github.com/CodePeasant" title="GitHub">GitHub</a>
		
		
		
		  <a class="stackoverflow" href="http://stackoverflow.com/users/2853651/wuyixiang" title="StackOverflow"></a>
		
		
		
		
		
		
		
			<a class="email" href="mailto:1032197148@qq.com" title="Email">Email</a>
		
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">APUE笔记(Chapter 1~6)</h1>
	<div class="entry-content" itemprop="articleBody"><h1>APUE笔记(Chapter 1~6)</h1>

<h2>1.UNIX System Overview</h2>

<h3>Nonfatal error(man 3 errno)</h3>

<ul>
<li>EAGAIN/EWOULDBLOCK</li>
<li>ENFILE/ENOBUFS/ENOLCK/ENOSPC/ENOSR/ENOMEM/EBUSY</li>
</ul>


<h3>键盘信号</h3>

<ul>
<li>Ctrl+Z SIGTSTP</li>
<li>Ctrl+C SIGINT</li>
<li>Ctrl+D EOF</li>
<li>Ctrl+/ SIGQUIT</li>
</ul>


<h2>2.UNIX Standardization and Implementations</h2>

<ul>
<li>ISO C/POSIX/XSI</li>
<li>FreeBSD/Linux/MacOS/Solaris</li>
<li>gcc -D_POSIX_C_SOURCE=200112 file.c</li>
</ul>


<h2>3.File I/O</h2>

<h3>open/close</h3>

<ul>
<li>O_RDONLY/O_WRONLY/O_RDWR</li>
<li>O_APPEND/O_TRUNC/O_CREAT/O_EXCL/O_NONBLOCK</li>
<li>O_SYNC(write data&amp;attr)/O_DSYNC(write data)/O_RSYNC(read)</li>
<li>sync(all)/fsync(single)/fdatasync</li>
</ul>


<h3>read/write</h3>

<h3>lseek</h3>

<ul>
<li>SEEK_CUR/SEEK_SET/SEEK_END</li>
<li>pread/pwrite: lseek+read/write</li>
</ul>


<h3>dup/dup2</h3>

<ul>
<li>dup(fd): fcntl(fd, O_DUPFD, 0)</li>
<li>dup2(fd1, fd2): close(fd2);fcntl(fd1, O_DUPFD, fd2)</li>
</ul>


<h3>fcntl</h3>

<ul>
<li>F_DUPFD</li>
<li>F_GETFD/F_SETFD(file descriptor, FD_CLOEXEC only)</li>
<li>F_GETFL/F_SETFL(file status, O_NONBLOCK and so on)</li>
<li>F_GETOWN/F_SETOWN</li>
<li>F_GETLK/F_SETLK/F_SETLKW</li>
<li>ioctl(driver, no need to known)</li>
</ul>


<h2>4.Files and Directories</h2>

<h3>stat(file path)/fstat(file decriptor id)/lstat(show symbolic link)</h3>

<ul>
<li>st_mode(file type&amp;permission)</li>
<li>st_ino/st_dev/st_rdev</li>
<li>st_nlink</li>
<li>st_uid/st_gid</li>
<li>st_size</li>
<li>st_atime[ls -u] last access , read()</li>
<li>st_mtime[ls] last modify, write()</li>
<li>st_ctime[ls -c] last inode status chagne, chown()</li>
<li>st_blksize</li>
<li>st_blocks(number of disk block allocate)</li>
</ul>


<h3>File Type</h3>

<ul>
<li>Regular file(S_ISREG)</li>
<li>Directory file(S_ISDIR)</li>
<li>Block special file(S_ISBLK)</li>
<li>Character special file(S_ISCHR)</li>
<li>FIFO(S_ISFIFO)[named pipe]</li>
<li>Socket(S_ISSOCK)</li>
<li>Symbolic link(S_ISLNK)</li>
</ul>


<h3>IPC</h3>

<ul>
<li>MQ message queue</li>
<li>SEM semaphore</li>
<li>SHM shared memory object</li>
</ul>


<h3>Process uid/gid</h3>

<ul>
<li>real userID/groudID(who excute the process)</li>
<li>effective userID/groupID(the permisson check)[by default is real userID/groupID, use set-user-id to be the file owner]</li>
<li>saved set-user-ID/groud-ID(save the last effective when effective change)</li>
<li>supplement group IDs</li>
</ul>


<h3>File Access Permissions</h3>

<ul>
<li>R:4, W :2, X:1</li>
<li>S_I(R/W/X)(USR/GRP/OTH)</li>
<li>open file need X for directory(if you known this file, R is no need)</li>
<li>list file need R for directory</li>
<li>create/ delete file need W&amp;X for directory, W for file is no need</li>
<li>access(path, mode): access permission test</li>
<li>umask(cmask): set the access permission for file this process create, turn off the bit in cmask</li>
<li>fchmod(fd, mode)</li>
</ul>


<h3>chown/fchown/lchown</h3>

<ul>
<li>chwon(path,owner,group)</li>
<li>chown -R user:group file/directory</li>
</ul>


<h3>file system</h3>

<ul>
<li>driver/parition(one file system per partition)/cylinde/(inodes+blocks)</li>
<li>a inode is a file, point to many data block</li>
<li>a inode can be link from many directory, when not process open the file and all directory unlink, delete the inode, but the data block still exist[hard link, just add st_nlink, create hard link for directory is not allowed]</li>
<li>symbolic link: add a new inode point to source file path, no add st_nlink</li>
<li>link(oldpath,newpath), symlink(actualpath,sympath), unlink(path), remove(path), rename(old,new)</li>
<li>mkdir/rmdir/chdir/fchdir/getcwd</li>
<li>opendir/readdir/rewinddir/closedir/telldir/seekdir</li>
<li>DIR structure like FILE, with the offset</li>
<li>st_dev: major is the disk num, minor is the filesystem num</li>
<li>st_rdev: valid for character device &amp; block device, the real device it is on</li>
</ul>


<h2>5.Standard I/O Library</h2>

<h3>Stream Buffer</h3>

<ul>
<li>Fully Buffered</li>
<li>Line Buffered</li>
<li>Unbuffered</li>
</ul>


<h3>Stream Read&amp;Write</h3>

<h4>Character-at-a-time I/O:</h4>

<ul>
<li>getc(fp)/fgetc(fp)/getchar()</li>
<li>getchar()=getc(STDIN)</li>
<li>getc is macro and fgetc is function, they are same</li>
<li>ungetc(c,fp)[put char back into stream]</li>
<li>putc(c, fp)/fputc(c, fp)/putchar&copy;</li>
</ul>


<h4>Line-at-a-time I/O:</h4>

<ul>
<li>fgets(buf,n,fp)</li>
<li>fputs(str,fp)</li>
</ul>


<h4>Direct I/O(Binary I/O):</h4>

<ul>
<li>fread(ptr, size, n, fp)</li>
<li>fwrite(ptr, size, n, fp)</li>
<li>ftell(fp)/fseek(fp, offset, whence)/rewind(fp)</li>
</ul>


<h3>Formatted I/O</h3>

<ul>
<li>printf(format, &hellip;)</li>
<li>fprintf(fp, format, ..)</li>
<li>sprintf(buf, format, ..)</li>
<li>snprintf(buf, n, format, &hellip;)</li>
<li>scanf(format, &hellip;)</li>
<li>fscanf(fp, format, &hellip;)</li>
<li>sscanf(buf, format, &hellip;)</li>
</ul>


<h3>Temporary Files</h3>

<ul>
<li>char *tmpname(ptr)</li>
<li>char *tempnam(directory, prefix)</li>
<li>File* tmpfile()</li>
<li>int mktemp(template)[return fd]</li>
<li>tmpname&amp;tempnam都有time window问题，应使用temfile&amp;mktemp</li>
</ul>


<h2>6.System Data Files and Information</h2>

<h3>Password File</h3>

<ul>
<li>passwd <em>getpwuid(uid)/passwd </em>getpwnam(name)</li>
<li>passwd *getpwent()[get by next, null return by end]</li>
<li>setpwent()[open/rewind]</li>
<li>endpwent()[close]</li>
</ul>


<h3>Shadow File(保存加密后的密码)</h3>

<ul>
<li>spwd *getspnam(name)</li>
<li>spwd *getspent()/setspent()/endspent()</li>
</ul>


<h3>Group File</h3>

<ul>
<li>group <em>getgrgid(gid)/group </em>getgrnam(name)</li>
<li>group *getgpent()/setgrent()/endgrent()</li>
<li>char **group->gr_mem指向属于本group的user_name</li>
<li>Supplementary Group IDs make a user can belong up to 16 addtional groups</li>
</ul>


<h3>Datetime</h3>

<ul>
<li>time_t time(time_t *) seconds from Epoch</li>
<li>gettimeofday(timeval *, NULL) seconds &amp; microseconds from Epoch</li>
<li>tm <em>gmtime(time_t </em>) time_t to tm UTC(calendar form)</li>
<li>tm <em>localtime(time_t </em>) time_t to tm local timezone</li>
<li>time_t mktime(tm *) tm to time_t</li>
<li>char <em>asctime(tm </em>) tm to string</li>
<li>char <em>ctime(time_t </em>) time_t to string</li>
<li>strftime(buf, maxsize, format, tm*) tm to format string</li>
</ul>

</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">评论</h1>
    

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'codepeasant'; // required: replace example with your forum shortname
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - 吴逸翔 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			




  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
